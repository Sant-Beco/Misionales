<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <style>
    body {
      font-family: Arial, sans-serif;
      font-size: 11px;
      margin: 25px;
      color: #000;
    }
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 2px solid #000;
      padding-bottom: 8px;
      margin-bottom: 10px;
    }
    .header img {
      height: 60px;
    }
    .titulo {
      text-align: center;
      font-weight: bold;
      font-size: 13px;
      margin-top: 5px;
      text-transform: uppercase;
    }
    .subtitulo {
      text-align: center;
      font-size: 10px;
      margin-bottom: 10px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      font-size: 10px;
    }
    th, td {
      border: 1px solid #000;
      text-align: center;
      padding: 4px;
    }
    th {
      background-color: #f0f0f0;
      font-weight: bold;
    }
    .aspecto {
      text-align: left;
      width: 38%;
    }
    .firma {
      margin-top: 25px;
      text-align: left;
    }
    .firma img {
      width: 60px;
      height: 60px;
      border: 1px solid #000;
    }
    .footer {
      margin-top: 15px;
      font-size: 10px;
      border-top: 1px solid #000;
      padding-top: 5px;
    }
  </style>
</head>
<body>

  <!-- Encabezado -->
  <div class="header">
    <img src="app/static/img/incubant.jpg" alt="Logo Incubant" />
    <div>
      <div class="titulo">INSPECCIÓN PRE OPERACIONAL MOTOCICLETA</div>
      <div class="subtitulo">
        Código: {{ codigo }} — Fecha: {{ fecha }} — Versión: {{ version }}
      </div>
    </div>
  </div>

  <!-- Tabla principal -->
  <table>
    <thead>
      <tr>
        <th rowspan="2">Aspectos a Revisar</th>
        {% for i in range(1,16) %}
        <th colspan="2">Día {{ i }}</th>
        {% endfor %}
      </tr>
      <tr>
        {% for i in range(1,16) %}
        <th>B</th>
        <th>M</th>
        {% endfor %}
      </tr>
    </thead>
    <tbody>
      {% set aspectos_lista = [
        "1. Estado de llantas y presión de aire",
        "2. Encendido eléctrico y de crank",
        "3. Luces y pito",
        "4. Espejos retrovisores",
        "5. Manijas de freno y clutch",
        "6. Sistema de frenos",
        "7. Estado de freno de disco",
        "8. Nivel de líquido de freno",
        "9. Revisión sistema tablero",
        "10. Fugas de combustible y/o aceites",
        "11. Kit de arrastre",
        "12. Estado de suspensión",
        "13. Nivel de aceites",
        "14. Otros aspectos observados"
      ] %}
      
      {% for aspecto in aspectos_lista %}
      <tr>
        <td class="aspecto">{{ aspecto }}</td>
        {% for registro in registros %}
          {% set aspectos_data = registro.aspectos|default('{}')|safe|loads %}
          <td>{% if aspectos_data.get(loop.index|string, '') == 'B' %}X{% endif %}</td>
          <td>{% if aspectos_data.get(loop.index|string, '') == 'M' %}X{% endif %}</td>
        {% endfor %}
        {% for i in range(15 - registros|length) %}
          <td></td><td></td>
        {% endfor %}
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Pregunta final -->
  <div style="margin-top:10px; font-size:11px;">
    <strong>¿El vehículo se encuentra en óptimas condiciones para su operación?</strong>
    {% if registros and registros[-1].condiciones_optimas == "SI" %}
      Sí ☑️  No ☐
    {% else %}
      Sí ☐  No ☑️
    {% endif %}
  </div>

  <!-- Firma -->
  {% if registros and registros[-1].firma_file %}
  <div class="firma">
    <p><strong>Firma del conductor:</strong></p>
    <img src="app/data/generated_pdfs/{{ registros[-1].firma_file }}" alt="Firma" />
  </div>
  {% endif %}

  <!-- Footer -->
  <div class="footer">
    <em>Este formato es de uso exclusivo de INCUBANT SAS - Sistema de Gestión de Seguridad y Salud en el Trabajo (SST)</em>
  </div>

</body>
</html>

