<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <style>
    @page { size: A4 landscape; margin: 8mm; }
    body { font-family: DejaVu Sans, Arial, sans-serif; font-size:10px; margin:0; color:#000; }
    .encabezado { display:flex; align-items:center; gap:12px; padding:6px 0; border-bottom:2px solid #000; }
    .logo { width:90px; }
    .titulo { flex:1; text-align:center; font-weight:700; font-size:18px; text-transform:uppercase; }
    .subinfo { text-align:center; font-size:11px; margin:6px 0; }

    table { width:100%; border-collapse: collapse; margin-top:6px; }
    th, td { border:1px solid #222; padding:4px; vertical-align:middle; }
    th { background:#eee; font-weight:700; font-size:10px; text-transform:uppercase; }

    .aspectos td { text-align:center; }
    .aspectos .left { text-align:left; padding-left:8px; }

    .box { display:inline-block; width:18px; height:18px; border:1px solid #222; text-align:center; line-height:18px; font-weight:700; font-size:12px; }

    .firma { margin-top:10px; }
    .firma img { width:70px; height:auto; border:1px solid #222; display:block; margin-top:6px; }
    .nota { font-size:9px; margin-top:8px; border-top:1px solid #ddd; padding-top:6px; }
  </style>
</head>
<body>
  <div class="encabezado">
    <img class="logo" src="app/static/img/incubant.jpg" alt="Logo">
    <div class="titulo">INSPECCIÓN PRE OPERACIONAL MOTOCICLETA</div>
  </div>

  <div class="subinfo">
    Código: {{ codigo }} — Versión: {{ version }} — Fecha consolidado: {{ fecha }}<br>
    Registros desde: <strong>{{ desde }}</strong> hasta <strong>{{ hasta }}</strong>
  </div>

  <!-- DATOS (primer registro) -->
  <table>
    <tr>
      <th>NOMBRE CONDUCTOR</th><td colspan="3">{{ registros[0].nombre_conductor }}</td>
      <th>PLACA</th><td colspan="3">{{ registros[0].placa }}</td>
    </tr>
    <tr>
      <th>PROCESO</th><td colspan="3">{{ registros[0].proceso }}</td>
      <th>MARCA</th><td colspan="3">{{ registros[0].marca }}</td>
    </tr>
    <tr>
      <th>GASOLINA</th><td colspan="3">{{ registros[0].gasolina }}</td>
      <th>MODELO</th><td colspan="3">{{ registros[0].modelo }}</td>
    </tr>
    <tr>
      <th>MOTOR</th><td colspan="3">{{ registros[0].motor }}</td>
      <th>LÍNEA</th><td colspan="3">{{ registros[0].linea }}</td>
    </tr>
  </table>

  {% set aspectos_lista = [
    "Estado de llantas y presión de aire",
    "Encendido eléctrico y de crank",
    "Luces y pito",
    "Espejos retrovisores",
    "Manijas de freno y clutch",
    "Sistema de frenos",
    "Estado de freno de disco",
    "Nivel de líquido de freno",
    "Revisión sistema tablero",
    "Fugas de combustible y/o aceites",
    "Kit de arrastre",
    "Estado de suspensión",
    "Nivel de aceites"
  ] %}

  <!-- TABLA ASPECTOS -->
  <table class="aspectos">
    <tr>
      <th rowspan="2" style="width:22%;">Aspectos a revisar</th>
      {% for i in range(1,16) %}
        <th colspan="2">{{ i }}</th>
      {% endfor %}
    </tr>
    <tr>
      {% for i in range(1,16) %}
        <th>B</th><th>M</th>
      {% endfor %}
    </tr>

    {% for aspecto in aspectos_lista %}
    {% set aspecto_idx = loop.index %}
    <tr>
      <td class="left">{{ aspecto }}</td>

      {% for i in range(15) %}
        {% set registro = registros[i] if i < registros|length else None %}
        {% if registro %}
          {% set val = (registro.aspectos_parsed or {}).get(aspecto_idx|string, '') %}
          <td>{% if val == 'B' %}<span class="box">✔</span>{% else %}<span class="box"></span>{% endif %}</td>
          <td>{% if val == 'M' %}<span class="box">✖</span>{% else %}<span class="box"></span>{% endif %}</td>
        {% else %}
          <td><span class="box"></span></td><td><span class="box"></span></td>
        {% endif %}
      {% endfor %}
    </tr>
    {% endfor %}
  </table>

  <!-- CONDICIONES -->
  <table style="margin-top:6px;">
    <tr>
      <th>¿ÓPTIMAS CONDICIONES?</th>
      {% for i in range(15) %}
        {% set registro = registros[i] if i < registros|length else None %}
        <td>{% if registro and registro.condiciones_optimas == "SI" %}<span class="box">✔</span>{% else %}<span class="box"></span>{% endif %}</td>
        <td>{% if registro and registro.condiciones_optimas == "NO" %}<span class="box">✖</span>{% else %}<span class="box"></span>{% endif %}</td>
      {% endfor %}
    </tr>
  </table>

  <!-- FIRMA -->
  <div class="firma">
    <strong>FIRMA DEL CONDUCTOR:</strong><br>
    {% if registros[0].firma_path %}
      <img src="{{ registros[0].firma_path }}" alt="Firma">
    {% else %}
      <span>(sin firma)</span>
    {% endif %}
  </div>

  <div class="nota">
    <strong>Nota:</strong> Inspeccione todos los elementos que apliquen. Detenga los funcionamientos cuando observe alguna condición insegura o que pueda causar algún peligro. Informe al responsable.
  </div>

</body>
</html>

